# 第一章 计算机网络和因特网

## 网络边缘

![avatar](img/1.jpg)

![avatar](img/2.jpg)

- Digital Subscriber Line：数字用户线，简称DSL

- DSLAM：位于电话公司本地中心局（CO）中的数字用户线接入复用器

- Hybird Fiber Coax：混合光纤同轴，简称HFC

- Fiber To The Home：光纤到户，简称FTTH
- 物理媒介：双绞铜线，同轴电缆，光纤，陆地无限电信道，卫星无线电信道

## 网络核心

### 分组交换

端系统之前交换报文，为了从源端系统向目的端系统发送报文，源将长报文划分为较小的数据块，称之为分组交换。每个分组都通过通信链和分组交换机（packet switch）。交换机主要有两类，路由器（router）和链路层交换机（link-layer switch）。

每台分组交换机有多条链路与之相连，每个链路上，该交换机具有一个输出缓存，也称为输出队列，所以分组要承受输出缓存的排队时延。

源段系统发送报文到目的端系统，就像边开车边问路一样，通过ip协议转发。

### 电路交换

电路交换和分组交换不同，在源端系统和目的端系统通信期间，会预留所需要的资源，即时双方没有报文传输（静默）的时候也需要占用通信链路。目前常用的方式是分组交换。

## 网络的网络

https://blog.csdn.net/binge_kong/article/details/100108836

## 时延的类型

节点处理时延，排队时延，传输时延，传播时延。

### 排队时延

节点时延中最复杂的是排队时延，也就是分组到达交换机后等待前面分组发送的时间。如果La是到达队列的平均速率，R是传输速率。则La/R是流量强度，设计系统时流量强度不能大于1。

### 丢包

分组交换中，交换机中的分组会进行排队。但是交换机能容纳的排队的分组不能无限增加，所以当到达的分组已经无法容纳时，会出现丢包。
### 吞吐量
## 协议分层
- 应用层：如HTTP、SMTP、FTP等属于应用层的协议。我们把位于应用层的信息分组称为报文（message）
- 运输层：有两种运输协议，即TCP和UDP。TCP向它的应用程序提供了面向连接的服务，TCP也将长报文分为短报文，并提供拥塞控制机制。UDP协议向它的应用程序提供无连接服务，没有可靠性，没有流量控制，没有拥塞控制。我们把运输层的分组称为报文段（segment）
- 网络层：网络层负责将成为数据报（datagram）的网络层分组从一台主机移动到另一台主机。网络层包括一个著名的网络协议，即IP协议
- 链路层：网络层通过源和目的地之间的一系列路由器路由数据报。为了将分组从一个节点（主机或路由器）移动到路径上的下一个节点，网络层必须依靠该链路层的服务。在下一个节点，链路层将数据报上传给网络层。链路层的例子包括以太网、WiFi和电缆接入网的DOCSIS协议。我们把链路层的分组称为帧（frame）
- 物理层：物理层的任务时将该帧中的一个个比特从一个节点移动到下一个节点。以太网具有许多物理层协议：一个是关于双绞铜线的，另一个是关于同轴电缆的，还有一个是关于光纤的。
## OSI模型
20世纪70年代后，国际标准组织ISO提出计算机网络围绕7层来组织，称为开放系统互联（OSI）模型【ISO 2016】。OSI参考模型的7层时：应用层、表示层、会话层、运输层、网络层、数据链路层和物理层。
- 表示层：使通信的应用程序能够解释交换数据的含义，包括数据压缩和数据加密以及数据描述
- 会话层：提供了数据交换的定界和同步功能，包括了建立检查和恢复方案的方法
## 封装
在发送主机端，一个应用层报文被传输给运输层，运输层接收到报文并附上附加信息，该首部被接受端的运输层使用。应用层保温和运输层首部信息一道构成了运输层报文段。同理，从发送主机端协议栈向下继续生成网络层的数据报、链路层的链路层帧。所以在每一层，一个分组具有两种类型的字段：首部字段和有效荷载字段（payload field）。
## 面对攻击的网络
- 病毒和蠕虫：随网络传播的恶意的东西统称为恶意软件（malware）。被攻击的网络称为僵尸网络（botnet）。多数的恶意软件是自我复制的（self-replication）。一旦它感染了一台主机，会在网络上寻找其他主机进行自我复制。其中病毒（virus）是一种需要某种形式的用户交互来感染的恶意软件。蠕虫（worm）是一种无须任何明显用户交互就能进入设备的恶意软件。
- Dos和DDos：Dos全称Denial-of-Service attack，即拒绝服务攻击。它属于下列三种类型之一：<br/>
弱点攻击：像应用程序或操作系统发送报文，是的服务器停止运行甚至主机崩溃<br/>
贷款洪范：攻击者向主机发送大量分组，使目的的介入链接变得拥塞，合法分组无法到达服务器<br/>
连接洪泛：攻击者在目标主机中创建大量的半开或全开TCP连接，该主机因为伪造的连接停止接受合法的连接。
- 嗅探分组：攻击者复制网络中传输的分组副本
- 伪装信任：将具有虚假源地址的分组注入到因特网称为IP哄骗

# 第二章 应用层

## 进程通信

多个端系统上的程序进行通信的实际上是进程（process），两个不同端系统上的进程，通过跨越计算机网络交换报文而相互通信。

### 套接字

进程通过一个成为套接字（socket）的软件接口向另一个进程发送和从网络接收报文。由于该套接字是建立网络应用程序的可编程接口，因此套接字也成为应用程序和网络质检的应用程序编程接口（Application Programming Interface,API）。应用程序开发者可以控制套接字在应用层端的一切，但是对该套接字的运输层几乎没有控制权。

### 进程寻址

在一台主机上运行的进程为了向另一台主机上运行的进程发送分组，接收进程需要有一个地址。为了标识该接收进程，需要定义两个信息：1.主机地址（IP地址：IP address）；2.在目的主机中指定接收进程的标识符（端口号：port number）。

- 可靠数据传输：如果一个协议提供了确保数据交付的服务，就认为提供了可靠数据传输。当运输层协议不提供可靠数据传输时，会被容忍丢失的应用（loss-tolerant application）所接收，如音频视频等
- 吞吐量：具有吞吐量要求的应用程序被称为带宽敏感的应用（bandwidth-sensitive application）。反之称为弹性应用（elastic application）。当然吞吐量肯定越大越好
- 定时保证，即时延
- 安全性，即加密

## TCP服务

- 面向连接的服务：在应用层报文开始流动前，TCP让客户和服务器互相交换运输层信息，也就是握手。在此之后，一个TCP连接（TCP connection）就在两个进程的套接字之间建立了。这条连接是全双工的，当应用程序结束报文发送时，必须拆除该连接

- 可靠的数据传送服务：依靠TCP，可以无差错、按适当顺序交付所有发送的数据。

- TCP协议还具有拥塞控制机制。当发送方和接收方之间的网络出现拥塞时，TCP的拥塞控制会抑制发送进程（客户或服务器）

## UDP服务

UDP是一种提供不必要服务的的轻量级运输协议，它仅提供做小服务。UDP是无连接的，因此没有握手过程。它提供一种不可靠数据传送服务，不保证该报文将到达接收进程。不仅如此，到达接收进程的报文也可能是乱序到达的。UDP也没有拥塞机制，可以以任何速率向下层注入数据。

![avatar](img/3.jpg)

## 应用层协议

应用层协议（application-layer protocol）定义了运行在不同端系统上的应用程序进程如何相互传递报文。特别是应用层协议定义了 ：

- 交换的报文类型，例如请求报文和响应报文。
- 各种报文类型的语法，如报文中的各个字段及这些字段是如何描述的。
- 字段的语义，即这些字段中的信息的含义。
- 确定一个进程何时以及如何发送报文，对报文进行响应的规则。

### HTTP

#### 概况

HTTP使用TCP作为他的支撑运输协议

HTTP是一个无状态协议（stateless protocol）

#### 非持续连接和持续连接

![avatar](img/4.png)

##### 非持续连接

- HTTP客户端发起一个TCP连接（默认向80端口发送）
- 客户端向套接字发送报文
- 服务器经过处理发送响应报文
- HTTP服务器进程通知TCP断开该TCP连接（知道TCP确认客户端已经完整地收到响应报文为止，才会实际中断连接）
- HTTP客户端接收响应报文，TCP连接关闭
- 如果返回报文中有其他对象，重复前4个步骤

RTT：Round-Trip Time，即客户端从发送请求到接收响应的往返时间。

客户端和服务器之间需要进行一个“三次握手”。客户端向服务器发送一个小TCP报文段，服务器用一个小TCP报文段做出确认和响应。最后客户端向服务器返回确认。其中前两次占用了一个RTT，客户端结合三次握手的第三部分（确认）向该TCP连接发送一个HTTP请求报文，服务器返回响应文件，这个过程占用一个RTT。

##### 持续连接

非持续连接有一个缺点，必须为每一个请求的对象建立和维护一个全新的连接，这给服务器带来严重的负担。其次，每一个对象经受两次RTT的交付时延。

HTTP1.1持续连接的情况下，服务器在发送响应后保持该TCP连接打开。在相同的客户与服务器之间，后续的请求和响应报文能够通过相同的连接进行传送。

#### HTTP报文格式

##### HTTP请求报文

GET /somedir/page.html HTTP/1.1
Host:www.someschool.edu
Connection:close
User-agent:Mozilla/5.0
Accept-language:fr

一个请求报文能够具有更多的行或者至少具有一行。

其中第一行叫做请求行（request line），后继的行叫做首部行（header line）。

- 请求行有三个字段：方法字段、URL字段和HTTP版本字段。其中方法字段包括GET、POST、HEAD、PUT和DELETE。URL字段带有请求对象的标识。

- 首部行HOST：指明了对象所在的主机
- 首部行Connection：close标识不使用持续连接
- 首部行User-agent：指明用户代理，这里Mozilla/5.0标识是firefox浏览器
- 首部行Accept-language：用户想得到该对象的语法版本，否则服务器将发送默认版本

当用户使用POST方法时才使用下图中的实体体（entity body），GET方法不会使用。

HEAD类似于GET

当用户提交对象到服务器的指定路径（目录）时使用PUT

当用户删除服务器对象是使用DELETE

![avatar](img/5.png)

##### HTTP响应报文

HTTP/1.1 200 OK
Connection：close
Date:Thu,18 Aug 2015 15:44:04 GMT
Server: Apache/2.2.3(CentOS)
Last-Modified: Thu,18 Aug 2015 15:11:03 GMT
Content-Length:6821
Content-Type:text/html

(data data data ...)

响应报文它分为三个部分：

一个初始状态行（status line），6个首部行（header line），然后是实体体（entity body）。

- 状态行：有3个字段。协议版本字段、状态码和响应状态信息。
- Connection：close首部行告诉客户，发送完报文后将关闭TCP连接
- Date：指示服务器产生并发送该响应报文的日期和时间。该时间是组织响应报文的时间，不是对象修改时间
- Server：指示该报文是有一台Apache Web服务器产生的
- Last-Modified：指示了该对象创建或最后修改的日期和时间
- Content-Length：指示了被发送对象中的字节数
- Content-Type：指示了该实体对象是HTML文本



![avatar](img/6.png)

状态码及其相应的短语指示了请求的结果：

200 Ok:请求成功，信息包含在返回的报文中
301 Moved permanently:请求的对象已经被永久转移了，新的URL定义在响应报文的Location
400 Bad Request：一个通常差错代码，指请求不能被服务器理解。
404 Not Found: 被请求的文档不在服务器上。
505 Http version Not Supported：服务器不支持请求的报文使用的HTTP协议版本。









































